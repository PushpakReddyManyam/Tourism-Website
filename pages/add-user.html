<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Add User — ExploreWorld Admin</title>
  <link rel="stylesheet" href="../css/main.css" />
  <style>
    body {
      font-family: Poppins, sans-serif;
      background: #121212;
      color: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      padding: 16px;
    }

    .card {
      background: #1e1e1e;
      padding: 24px;
      border-radius: 10px;
      width: 420px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.4);
    }

    h2 {
      color: #00eaff;
      margin-bottom: 12px;
      text-align: center;
    }

    label {
      display: block;
      margin-bottom: 6px;
      color: #cfcfcf;
      font-size: 0.9rem;
    }

    input, select, button, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 12px;
      border-radius: 6px;
      border: none;
      outline: none;
      box-sizing: border-box;
      font-size: 0.95rem;
    }

    input, select, textarea {
      background: #2a2a2a;
      color: #f5f5f5;
    }

    button {
      background: #00eaff;
      color: #000;
      font-weight: 700;
      border: none;
      cursor: pointer;
    }

    button:hover { filter: brightness(0.95); }

    a {
      color: #00eaff;
      display: block;
      text-align: center;
      margin-top: 6px;
      text-decoration: none;
    }

    /* ===== Date input fixes ===== */
    /* Ensure native appearance on supporting browsers */
    input[type="date"] {
      -webkit-appearance: textfield; /* keep input like textfield but allow calendar */
      appearance: auto;
      position: relative;
      padding-right: 40px; /* room for the calendar indicator on some browsers */
      background-clip: padding-box;
      cursor: text;
    }

    /* Make the little calendar icon visible and clickable in WebKit/Blink */
    input[type="date"]::-webkit-calendar-picker-indicator {
      position: absolute;
      right: 8px;
      width: 28px;
      height: 28px;
      color: #fff;
      opacity: 0.95;
      cursor: pointer;
      filter: invert(1) drop-shadow(0 0 0 rgba(0,0,0,0.0));
    }

    /* Firefox - keep its native appearance */
    input[type="date"]::-moz-focus-inner {
      border: 0;
    }

    /* Accessibility: visually hint the expected format when native not supported */
    input.date-fallback::placeholder {
      color: #9aa0a6;
    }

    /* small screens */
    @media (max-width: 480px) {
      .card { width: 100%; padding: 18px; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h2>Add New User</h2>

    <form id="addUserForm" novalidate>
      <label for="name">Full Name</label>
      <input id="name" type="text" placeholder="Full name" required />

      <label for="email">Email</label>
      <input id="email" type="email" placeholder="email@example.com" required />

      <label for="role">Role</label>
      <select id="role" required>
        <option value="">Select role</option>
        <option>Admin</option>
        <option>Editor</option>
        <option>Viewer</option>
      </select>

      <label for="dob">Date of Birth</label>
      <!-- keep type="date" for native pickers, add date-fallback class to style placeholder -->
      <input id="dob" type="date" class="date-fallback" placeholder="YYYY-MM-DD" />

      <label for="password">Password</label>
      <input id="password" type="password" placeholder="min 6 chars" required />

      <button type="submit">Add User</button>
    </form>

    <a href="admin-dashboard.html">← Back to Dashboard</a>
  </div>

  <script>
    const USERS_KEY = 'ew_users';

    // seed demo users if none exist
    function seedIfEmpty() {
      if (!localStorage.getItem(USERS_KEY)) {
        const seed = [
          {id:1,name:"John Doe",email:"john@example.com",dob:"1998-05-15",role:"Admin"},
          {id:2,name:"Jane Smith",email:"jane@example.com",dob:"2000-02-10",role:"Editor"}
        ];
        localStorage.setItem(USERS_KEY, JSON.stringify(seed));
      }
    }

    function validEmail(e){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e); }

    // Try to make the date picker reliably open:
    (function enhanceDateInput() {
      const dob = document.getElementById('dob');
      // If browser supports the new showPicker() API, call it on focus to ensure picker opens.
      // This helps Chromium-based browsers where the picker sometimes doesn't open on focus.
      if (dob && typeof dob.showPicker === 'function') {
        dob.addEventListener('focus', () => {
          try { dob.showPicker(); } catch (err) { /* ignore */ }
        });
        dob.addEventListener('click', () => {
          try { dob.showPicker(); } catch (err) { /* ignore */ }
        });
      }

      // If browser does not support native date input, add a placeholder hint.
      // (Many modern browsers do support it; this is a graceful fallback.)
      const isDateSupported = (() => {
        const input = document.createElement('input');
        input.setAttribute('type', 'date');
        const unsupported = input.type === 'text';
        return !unsupported;
      })();

      if (!isDateSupported) {
        dob.classList.add('date-fallback');
        dob.setAttribute('placeholder', 'YYYY-MM-DD (type manually)');
        dob.type = 'text'; // allow manual typing
      }
    })();

    document.getElementById('addUserForm').addEventListener('submit', function(ev){
      ev.preventDefault();
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const role = document.getElementById('role').value;
      const dob = document.getElementById('dob').value;
      const password = document.getElementById('password').value;

      if(!name || !email || !role || !password) {
        alert('Please fill all required fields.');
        return;
      }
      if(!validEmail(email)) { alert('Enter a valid email.'); return; }
      if(password.length < 6) { alert('Password must be at least 6 characters.'); return; }

      const users = JSON.parse(localStorage.getItem(USERS_KEY) || '[]');
      const nextId = users.length ? Math.max(...users.map(u=>u.id)) + 1 : 1;
      users.unshift({id: nextId, name, email, dob, role});
      localStorage.setItem(USERS_KEY, JSON.stringify(users));

      alert(`User "${name}" added successfully!`);
      // Redirect to Manage Users so the admin can see the new entry
      window.location.href = "manage-users.html";
    });

    seedIfEmpty();
  </script>
</body>
</html>
