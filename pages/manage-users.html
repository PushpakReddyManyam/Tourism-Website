<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Manage Users — ExploreWorld Admin</title>
    <link rel="stylesheet" href="../css/main.css" />
    <style>
        body {
            font-family: Poppins, sans-serif;
            background: #121212;
            color: #f5f5f5;
            padding: 24px
        }

        .top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap
        }

        h1 {
            color: #00eaff
        }

        .btn {
            background: #00eaff;
            color: #000;
            padding: 8px 12px;
            border-radius: 6px;
            border: none;
            font-weight: 700;
            text-decoration: none
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 18px;
            background: #1e1e1e;
            border-radius: 8px;
            overflow: hidden
        }

        th,
        td {
            padding: 10px;
            border-bottom: 1px solid #333;
            text-align: left
        }

        th {
            background: #00eaff;
            color: #000
        }

        .actions button {
            margin-right: 6px;
            padding: 6px 8px;
            border-radius: 6px;
            border: none;
            cursor: pointer
        }

        .del {
            background: #f44336;
            color: #fff
        }

        .edit {
            background: #ffc107;
            color: #000
        }

        .modal {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.6)
        }

        .modal-content {
            background: #1e1e1e;
            padding: 18px;
            border-radius: 8px;
            width: 360px
        }

        label {
            display: block;
            margin-top: 8px;
            color: #ccc
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            margin-top: 6px;
            border-radius: 6px;
            border: none;
            background: #2a2a2a;
            color: #f5f5f5
        }

        .row {
            display: flex;
            gap: 8px
        }
    </style>
</head>

<body>
    <div class="top">
        <h1>Manage Users</h1>
        <div>
            <a class="btn" href="add-user.html">➕ Add User</a>
            <a class="btn" href="admin-dashboard.html" style="background:#444;color:#fff">← Dashboard</a>
        </div>
    </div>

    <table id="usersTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>DOB</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <!-- simple modal for edit -->
    <div id="editModal" style="display:none" class="modal">
        <div class="modal-content">
            <h3 style="color:#00eaff">Edit User</h3>
            <form id="editForm">
                <input type="hidden" id="editId" />
                <label>Name</label><input id="editName" />
                <label>Email</label><input id="editEmail" />
                <label>Role</label>
                <select id="editRole">
                    <option>Admin</option>
                    <option>Editor</option>
                    <option>Viewer</option>
                </select>
                <label>DOB</label><input id="editDob" type="date" />
                <div style="margin-top:12px;text-align:right">
                    <button type="button" onclick="closeModal()"
                        style="margin-right:8px;background:#666;color:#fff;padding:8px;border-radius:6px;border:none">Cancel</button>
                    <button type="submit"
                        style="background:#00eaff;color:#000;padding:8px;border-radius:6px;border:none">Save</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const USERS_KEY = 'ew_users';

        function seedIfEmpty() {
            if (!localStorage.getItem(USERS_KEY)) {
                const seed = [
                    { id: 1, name: "John Doe", email: "john@example.com", dob: "1998-05-15", role: "Admin" },
                    { id: 2, name: "Jane Smith", email: "jane@example.com", dob: "2000-02-10", role: "Editor" }
                ];
                localStorage.setItem(USERS_KEY, JSON.stringify(seed));
            }
        }

        function loadUsers() {
            const users = JSON.parse(localStorage.getItem(USERS_KEY) || '[]');
            const tbody = document.querySelector('#usersTable tbody');
            tbody.innerHTML = '';
            users.forEach(u => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
          <td>${u.name}</td>
          <td>${u.email}</td>
          <td>${u.role || '-'}</td>
          <td>${u.dob || '-'}</td>
          <td class="actions">
            <button class="edit" onclick='openEdit(${u.id})'>Edit</button>
            <button class="del" onclick='deleteUser(${u.id})'>Delete</button>
          </td>`;
                tbody.appendChild(tr);
            });
        }

        function deleteUser(id) {
            if (!confirm('Delete this user?')) return;
            const arr = JSON.parse(localStorage.getItem(USERS_KEY) || '[]').filter(u => u.id !== id);
            localStorage.setItem(USERS_KEY, JSON.stringify(arr));
            alert('User deleted.');
            loadUsers();
        }

        function openEdit(id) {
            const arr = JSON.parse(localStorage.getItem(USERS_KEY) || '[]');
            const u = arr.find(x => x.id === id);
            if (!u) return alert('User not found');
            document.getElementById('editId').value = u.id;
            document.getElementById('editName').value = u.name;
            document.getElementById('editEmail').value = u.email;
            document.getElementById('editRole').value = u.role || 'Viewer';
            document.getElementById('editDob').value = u.dob || '';
            document.getElementById('editModal').style.display = 'flex';
        }

        function closeModal() { document.getElementById('editModal').style.display = 'none'; }

        document.getElementById('editForm').addEventListener('submit', function (e) {
            e.preventDefault();
            const id = Number(document.getElementById('editId').value);
            const name = document.getElementById('editName').value.trim();
            const email = document.getElementById('editEmail').value.trim();
            const role = document.getElementById('editRole').value;
            const dob = document.getElementById('editDob').value;

            if (!name || !email) { alert('Name and email required'); return; }
            const arr = JSON.parse(localStorage.getItem(USERS_KEY) || '[]');
            const idx = arr.findIndex(x => x.id === id);
            if (idx === -1) return alert('User not found');
            arr[idx] = { ...arr[idx], name, email, role, dob };
            localStorage.setItem(USERS_KEY, JSON.stringify(arr));
            alert('User updated.');
            closeModal();
            loadUsers();
        });

        seedIfEmpty();
        loadUsers();
    </script>
</body>

</html>